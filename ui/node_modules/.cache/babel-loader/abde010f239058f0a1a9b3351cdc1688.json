{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.reducer = exports.requireResource = exports.deleteResource = exports.updateResource = exports.readEndpoint = exports.createResource = exports.hydrateStore = exports.setAxiosConfig = exports.IS_UPDATING = exports.IS_DELETING = undefined;\n\nvar _defineProperty2 = require('babel-runtime/helpers/defineProperty');\n\nvar _defineProperty3 = _interopRequireDefault(_defineProperty2);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _promise = require('babel-runtime/core-js/promise');\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar _stringify = require('babel-runtime/core-js/json/stringify');\n\nvar _stringify2 = _interopRequireDefault(_stringify);\n\nvar _extends2 = require('babel-runtime/helpers/extends');\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _handleActions;\n\nvar _reduxActions = require('redux-actions');\n\nvar _objectPathImmutable = require('object-path-immutable');\n\nvar _objectPathImmutable2 = _interopRequireDefault(_objectPathImmutable);\n\nvar _stateMutation = require('./state-mutation');\n\nvar _utils = require('./utils');\n\nvar _constants = require('./constants');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n} // Resource isInvalidating values\n\n\nvar IS_DELETING = exports.IS_DELETING = 'IS_DELETING';\nvar IS_UPDATING = exports.IS_UPDATING = 'IS_UPDATING'; // Action creators\n\nvar setAxiosConfig = exports.setAxiosConfig = (0, _reduxActions.createAction)(_constants.API_SET_AXIOS_CONFIG);\nvar hydrateStore = exports.hydrateStore = (0, _reduxActions.createAction)(_constants.API_HYDRATE);\nvar apiWillCreate = (0, _reduxActions.createAction)(_constants.API_WILL_CREATE);\nvar apiCreated = (0, _reduxActions.createAction)(_constants.API_CREATED);\nvar apiCreateFailed = (0, _reduxActions.createAction)(_constants.API_CREATE_FAILED);\nvar apiWillRead = (0, _reduxActions.createAction)(_constants.API_WILL_READ);\nvar apiRead = (0, _reduxActions.createAction)(_constants.API_READ);\nvar apiReadFailed = (0, _reduxActions.createAction)(_constants.API_READ_FAILED);\nvar apiWillUpdate = (0, _reduxActions.createAction)(_constants.API_WILL_UPDATE);\nvar apiUpdated = (0, _reduxActions.createAction)(_constants.API_UPDATED);\nvar apiUpdateFailed = (0, _reduxActions.createAction)(_constants.API_UPDATE_FAILED);\nvar apiWillDelete = (0, _reduxActions.createAction)(_constants.API_WILL_DELETE);\nvar apiDeleted = (0, _reduxActions.createAction)(_constants.API_DELETED);\nvar apiDeleteFailed = (0, _reduxActions.createAction)(_constants.API_DELETE_FAILED);\n\nvar createResource = exports.createResource = function createResource(resource) {\n  return function (dispatch, getState) {\n    dispatch(apiWillCreate(resource));\n    var axiosConfig = getState().api.endpoint.axiosConfig;\n    var options = (0, _extends3.default)({}, axiosConfig, {\n      method: 'POST',\n      data: (0, _stringify2.default)({\n        data: resource\n      })\n    });\n    return new _promise2.default(function (resolve, reject) {\n      (0, _utils.apiRequest)(resource.type, options).then(function (json) {\n        dispatch(apiCreated(json));\n        resolve(json);\n      }).catch(function (error) {\n        var err = error;\n        err.resource = resource;\n        dispatch(apiCreateFailed(err));\n        reject(err);\n      });\n    });\n  };\n};\n\nvar ApiResponse =\n/* eslint-enable */\nfunction ApiResponse(response, dispatch, nextUrl, prevUrl) {\n  var _this = this;\n\n  (0, _classCallCheck3.default)(this, ApiResponse);\n\n  this.loadNext = function () {\n    return _this.dispatch(readEndpoint(_this.nextUrl));\n  };\n\n  this.loadPrev = function () {\n    return _this.dispatch(readEndpoint(_this.prevUrl));\n  };\n\n  this.body = response;\n  this.dispatch = dispatch;\n  this.nextUrl = nextUrl;\n  this.prevUrl = prevUrl;\n}\n/* eslint-disable */\n;\n\nvar readEndpoint = exports.readEndpoint = function readEndpoint(endpoint) {\n  var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n      _ref$options = _ref.options,\n      options = _ref$options === undefined ? {\n    indexLinks: undefined\n  } : _ref$options;\n\n  return function (dispatch, getState) {\n    dispatch(apiWillRead(endpoint));\n    var axiosConfig = getState().api.endpoint.axiosConfig;\n    return new _promise2.default(function (resolve, reject) {\n      (0, _utils.apiRequest)(endpoint, axiosConfig).then(function (json) {\n        dispatch(apiRead((0, _extends3.default)({\n          endpoint: endpoint,\n          options: options\n        }, json)));\n        var nextUrl = (0, _utils.getPaginationUrl)(json, 'next', axiosConfig.baseURL);\n        var prevUrl = (0, _utils.getPaginationUrl)(json, 'prev', axiosConfig.baseURL);\n        resolve(new ApiResponse(json, dispatch, nextUrl, prevUrl));\n      }).catch(function (error) {\n        var err = error;\n        err.endpoint = endpoint;\n        dispatch(apiReadFailed(err));\n        reject(err);\n      });\n    });\n  };\n};\n\nvar updateResource = exports.updateResource = function updateResource(resource) {\n  return function (dispatch, getState) {\n    dispatch(apiWillUpdate(resource));\n    var axiosConfig = getState().api.endpoint.axiosConfig;\n    var endpoint = resource.type + '/' + resource.id;\n    var options = (0, _extends3.default)({}, axiosConfig, {\n      method: 'PATCH',\n      data: {\n        data: resource\n      }\n    });\n    return new _promise2.default(function (resolve, reject) {\n      (0, _utils.apiRequest)(endpoint, options).then(function (json) {\n        dispatch(apiUpdated(json));\n        resolve(json);\n      }).catch(function (error) {\n        var err = error;\n        err.resource = resource;\n        dispatch(apiUpdateFailed(err));\n        reject(err);\n      });\n    });\n  };\n};\n\nvar deleteResource = exports.deleteResource = function deleteResource(resource) {\n  return function (dispatch, getState) {\n    dispatch(apiWillDelete(resource));\n    var axiosConfig = getState().api.endpoint.axiosConfig;\n    var endpoint = resource.type + '/' + resource.id;\n    var options = (0, _extends3.default)({}, axiosConfig, {\n      method: 'DELETE'\n    });\n    return new _promise2.default(function (resolve, reject) {\n      (0, _utils.apiRequest)(endpoint, options).then(function () {\n        dispatch(apiDeleted(resource));\n        resolve();\n      }).catch(function (error) {\n        var err = error;\n        err.resource = resource;\n        dispatch(apiDeleteFailed(err));\n        reject(err);\n      });\n    });\n  };\n};\n\nvar requireResource = exports.requireResource = function requireResource(resourceType) {\n  var endpoint = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : resourceType;\n  return function (dispatch, getState) {\n    return new _promise2.default(function (resolve, reject) {\n      var _getState = getState(),\n          api = _getState.api;\n\n      if (api.hasOwnProperty(resourceType)) {\n        resolve();\n      }\n\n      dispatch(readEndpoint(endpoint)).then(resolve).catch(reject);\n    });\n  };\n}; // Reducers\n\n\nvar reducer = exports.reducer = (0, _reduxActions.handleActions)((_handleActions = {}, (0, _defineProperty3.default)(_handleActions, _constants.API_SET_AXIOS_CONFIG, function (state, _ref2) {\n  var axiosConfig = _ref2.payload;\n  return (0, _objectPathImmutable2.default)(state).set(['endpoint', 'axiosConfig'], axiosConfig).value();\n}), (0, _defineProperty3.default)(_handleActions, _constants.API_HYDRATE, function (state, _ref3) {\n  var resources = _ref3.payload;\n  var entities = Array.isArray(resources.data) ? resources.data : [resources.data];\n  var newState = (0, _stateMutation.updateOrInsertResourcesIntoState)(state, entities.concat(resources.included || []));\n  return (0, _objectPathImmutable2.default)(newState).value();\n}), (0, _defineProperty3.default)(_handleActions, _constants.API_WILL_CREATE, function (state) {\n  return (0, _objectPathImmutable2.default)(state).set(['isCreating'], state.isCreating + 1).value();\n}), (0, _defineProperty3.default)(_handleActions, _constants.API_CREATED, function (state, _ref4) {\n  var resources = _ref4.payload;\n  var entities = Array.isArray(resources.data) ? resources.data : [resources.data];\n  var newState = (0, _stateMutation.updateOrInsertResourcesIntoState)(state, entities.concat(resources.included || []));\n  return (0, _objectPathImmutable2.default)(newState).set('isCreating', state.isCreating - 1).value();\n}), (0, _defineProperty3.default)(_handleActions, _constants.API_CREATE_FAILED, function (state) {\n  return (0, _objectPathImmutable2.default)(state).set(['isCreating'], state.isCreating - 1).value();\n}), (0, _defineProperty3.default)(_handleActions, _constants.API_WILL_READ, function (state) {\n  return (0, _objectPathImmutable2.default)(state).set(['isReading'], state.isReading + 1).value();\n}), (0, _defineProperty3.default)(_handleActions, _constants.API_READ, function (state, _ref5) {\n  var payload = _ref5.payload;\n  var resources = (Array.isArray(payload.data) ? payload.data : [payload.data]).concat(payload.included || []);\n  var newState = (0, _stateMutation.updateOrInsertResourcesIntoState)(state, resources);\n  var finalState = (0, _stateMutation.addLinksToState)(newState, payload.links, payload.options);\n  return (0, _objectPathImmutable2.default)(finalState).set('isReading', state.isReading - 1).value();\n}), (0, _defineProperty3.default)(_handleActions, _constants.API_READ_FAILED, function (state) {\n  return (0, _objectPathImmutable2.default)(state).set(['isReading'], state.isReading - 1).value();\n}), (0, _defineProperty3.default)(_handleActions, _constants.API_WILL_UPDATE, function (state, _ref6) {\n  var resource = _ref6.payload;\n  var type = resource.type,\n      id = resource.id;\n  var newState = (0, _stateMutation.ensureResourceTypeInState)(state, type);\n  return (0, _stateMutation.setIsInvalidatingForExistingResource)(newState, {\n    type: type,\n    id: id\n  }, IS_UPDATING).set('isUpdating', state.isUpdating + 1).value();\n}), (0, _defineProperty3.default)(_handleActions, _constants.API_UPDATED, function (state, _ref7) {\n  var resources = _ref7.payload;\n  var entities = Array.isArray(resources.data) ? resources.data : [resources.data];\n  var newState = (0, _stateMutation.updateOrInsertResourcesIntoState)(state, entities.concat(resources.included || []));\n  return (0, _objectPathImmutable2.default)(newState).set('isUpdating', state.isUpdating - 1).value();\n}), (0, _defineProperty3.default)(_handleActions, _constants.API_UPDATE_FAILED, function (state, _ref8) {\n  var resource = _ref8.payload.resource;\n  var type = resource.type,\n      id = resource.id;\n  return (0, _stateMutation.setIsInvalidatingForExistingResource)(state, {\n    type: type,\n    id: id\n  }, IS_UPDATING).set('isUpdating', state.isUpdating - 1).value();\n}), (0, _defineProperty3.default)(_handleActions, _constants.API_WILL_DELETE, function (state, _ref9) {\n  var resource = _ref9.payload;\n  var type = resource.type,\n      id = resource.id;\n  return (0, _stateMutation.setIsInvalidatingForExistingResource)(state, {\n    type: type,\n    id: id\n  }, IS_DELETING).set('isDeleting', state.isDeleting + 1).value();\n}), (0, _defineProperty3.default)(_handleActions, _constants.API_DELETED, function (state, _ref10) {\n  var resource = _ref10.payload;\n  return (0, _stateMutation.removeResourceFromState)(state, resource).set('isDeleting', state.isDeleting - 1).value();\n}), (0, _defineProperty3.default)(_handleActions, _constants.API_DELETE_FAILED, function (state, _ref11) {\n  var resource = _ref11.payload.resource;\n  var type = resource.type,\n      id = resource.id;\n  return (0, _stateMutation.setIsInvalidatingForExistingResource)(state, {\n    type: type,\n    id: id\n  }, IS_DELETING).set('isDeleting', state.isDeleting - 1).value();\n}), _handleActions), {\n  isCreating: 0,\n  isReading: 0,\n  isUpdating: 0,\n  isDeleting: 0,\n  endpoint: {\n    axiosConfig: {}\n  }\n});","map":null,"metadata":{},"sourceType":"script"}